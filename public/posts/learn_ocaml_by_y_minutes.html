<!DOCTYPE html> <html lang="zh-CN"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Learn Ocaml in Y Minutes - Anonymous IPFS Blog</title>  <meta name="title" content="Learn Ocaml in Y Minutes - Anonymous IPFS Blog"> <meta name="description" content="OCaml æ˜¯ä¸€ç§ç»è¿‡ä¸¥æ ¼è¯„ä¼°çš„å‡½æ•°å¼è¯­è¨€ï¼Œå…·æœ‰ä¸€äº›å‘½ä»¤å¼åŠŸèƒ½ã€‚ å®ƒä¸æ ‡å‡† ML åŠå…¶æ–¹è¨€ä¸€èµ·å±äº ML è¯­è¨€å®¶æ—ã€‚ F# ä¹Ÿæ·±å— OCaml çš„å½±å“ã€‚ å°±åƒæ ‡å‡† ML ä¸€æ ·ï¼ŒOCaml å…·æœ‰å¯äº¤äº’ä½¿ç”¨çš„è§£é‡Šå™¨å’Œç¼–è¯‘å™¨ã€‚è§£é‡Šå™¨äºŒè¿›åˆ¶æ–‡ä»¶é€šå¸¸ç§°ä¸º ocaml ï¼Œç¼–è¯‘å™¨ç§°ä¸º ocamlopt ã€‚è¿˜æœ‰ä¸€ä¸ªå­—èŠ‚ç ç¼–è¯‘å™¨ ocaâ€¦"> <meta name="keywords" content="IPFS, blog, decentralized, Anonymous"> <meta name="author" content="DaviRain"> <meta name="robots" content="index, follow"> <meta name="language" content="Chinese">  <meta property="og:type" content="article"> <meta property="og:url" content="https:&#x2F;&#x2F;Anonymous.github.io&#x2F;kpgb/posts/learn_ocaml_by_y_minutes.html"> <meta property="og:title" content="Learn Ocaml in Y Minutes - Anonymous IPFS Blog"> <meta property="og:description" content="OCaml æ˜¯ä¸€ç§ç»è¿‡ä¸¥æ ¼è¯„ä¼°çš„å‡½æ•°å¼è¯­è¨€ï¼Œå…·æœ‰ä¸€äº›å‘½ä»¤å¼åŠŸèƒ½ã€‚ å®ƒä¸æ ‡å‡† ML åŠå…¶æ–¹è¨€ä¸€èµ·å±äº ML è¯­è¨€å®¶æ—ã€‚ F# ä¹Ÿæ·±å— OCaml çš„å½±å“ã€‚ å°±åƒæ ‡å‡† ML ä¸€æ ·ï¼ŒOCaml å…·æœ‰å¯äº¤äº’ä½¿ç”¨çš„è§£é‡Šå™¨å’Œç¼–è¯‘å™¨ã€‚è§£é‡Šå™¨äºŒè¿›åˆ¶æ–‡ä»¶é€šå¸¸ç§°ä¸º ocaml ï¼Œç¼–è¯‘å™¨ç§°ä¸º ocamlopt ã€‚è¿˜æœ‰ä¸€ä¸ªå­—èŠ‚ç ç¼–è¯‘å™¨ ocaâ€¦"> <meta property="og:image" content="https:&#x2F;&#x2F;Anonymous.github.io&#x2F;kpgb/images/og-default.svg"> <meta property="og:site_name" content="Anonymous IPFS Blog"> <meta property="article:published_time" content="2025-07-23T00:49:39+0000"> <meta property="article:modified_time" content="2025-07-23T00:49:40+0000"> <meta property="article:author" content="DaviRain">  <meta property="twitter:card" content="summary_large_image"> <meta property="twitter:url" content="https:&#x2F;&#x2F;Anonymous.github.io&#x2F;kpgb/posts/learn_ocaml_by_y_minutes.html"> <meta property="twitter:title" content="Learn Ocaml in Y Minutes - Anonymous IPFS Blog"> <meta property="twitter:description" content="OCaml æ˜¯ä¸€ç§ç»è¿‡ä¸¥æ ¼è¯„ä¼°çš„å‡½æ•°å¼è¯­è¨€ï¼Œå…·æœ‰ä¸€äº›å‘½ä»¤å¼åŠŸèƒ½ã€‚ å®ƒä¸æ ‡å‡† ML åŠå…¶æ–¹è¨€ä¸€èµ·å±äº ML è¯­è¨€å®¶æ—ã€‚ F# ä¹Ÿæ·±å— OCaml çš„å½±å“ã€‚ å°±åƒæ ‡å‡† ML ä¸€æ ·ï¼ŒOCaml å…·æœ‰å¯äº¤äº’ä½¿ç”¨çš„è§£é‡Šå™¨å’Œç¼–è¯‘å™¨ã€‚è§£é‡Šå™¨äºŒè¿›åˆ¶æ–‡ä»¶é€šå¸¸ç§°ä¸º ocaml ï¼Œç¼–è¯‘å™¨ç§°ä¸º ocamlopt ã€‚è¿˜æœ‰ä¸€ä¸ªå­—èŠ‚ç ç¼–è¯‘å™¨ ocaâ€¦"> <meta property="twitter:image" content="https:&#x2F;&#x2F;Anonymous.github.io&#x2F;kpgb/images/twitter-card.svg">  <link rel="canonical" href="https:&#x2F;&#x2F;Anonymous.github.io&#x2F;kpgb/posts/learn_ocaml_by_y_minutes.html">  <link rel="icon" type="image/svg+xml" href="&#x2F;kpgb/favicon.svg"> <link rel="alternate icon" href="&#x2F;kpgb/favicon.ico"> <link rel="manifest" href="&#x2F;kpgb/site.webmanifest">  <link rel="stylesheet" href="&#x2F;kpgb/css/style.css">  <link rel="alternate" type="application/rss+xml" title="Anonymous IPFS Blog RSS Feed" href="&#x2F;kpgb/feed.xml">  <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "headline": "Learn Ocaml in Y Minutes",
        "description": "OCaml æ˜¯ä¸€ç§ç»è¿‡ä¸¥æ ¼è¯„ä¼°çš„å‡½æ•°å¼è¯­è¨€ï¼Œå…·æœ‰ä¸€äº›å‘½ä»¤å¼åŠŸèƒ½ã€‚ å®ƒä¸æ ‡å‡† ML åŠå…¶æ–¹è¨€ä¸€èµ·å±äº ML è¯­è¨€å®¶æ—ã€‚ F# ä¹Ÿæ·±å— OCaml çš„å½±å“ã€‚ å°±åƒæ ‡å‡† ML ä¸€æ ·ï¼ŒOCaml å…·æœ‰å¯äº¤äº’ä½¿ç”¨çš„è§£é‡Šå™¨å’Œç¼–è¯‘å™¨ã€‚è§£é‡Šå™¨äºŒè¿›åˆ¶æ–‡ä»¶é€šå¸¸ç§°ä¸º ocaml ï¼Œç¼–è¯‘å™¨ç§°ä¸º ocamlopt ã€‚è¿˜æœ‰ä¸€ä¸ªå­—èŠ‚ç ç¼–è¯‘å™¨ ocamlc ï¼Œä½†ä½¿ç”¨å®ƒçš„ç†ç”±å¾ˆå°‘ã€‚ å®ƒè¿˜åŒ…æ‹¬åŒ…ç®¡ç†å™¨ opam å’Œæ„å»ºç³»ç»Ÿ dune ã€‚...",
        "author": {
            "@type": "Person",
            "name": "DaviRain"
        },
        "datePublished": "2025-07-23T00:49:39+0000",
        "dateModified": "2025-07-23T00:49:40+0000",
        "publisher": {
            "@type": "Organization",
            "name": "Anonymous IPFS Blog",
            "logo": {
                "@type": "ImageObject",
                "url": "https:&#x2F;&#x2F;Anonymous.github.io&#x2F;kpgb/images/logo.svg"
            }
        },
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:&#x2F;&#x2F;Anonymous.github.io&#x2F;kpgb/posts/learn_ocaml_by_y_minutes.html"
        },
        "wordCount": "3178",
        "keywords": "",
        
        "articleSection": "Tech",
        
        "inLanguage": "zh-CN"
    }
    </script>
    
</head>
<body>
    <header>
        <nav>
            <div class="container">
                <h1><a href="&#x2F;kpgb/">Anonymous IPFS Blog</a></h1>
                <ul>
                    <li><a href="&#x2F;kpgb/">Home</a></li>
                    <li><a href="&#x2F;kpgb/archive">Archive</a></li>
                    <li><a href="&#x2F;kpgb/tags">Tags</a></li>
                    <li><a href="&#x2F;kpgb/docs">Docs</a></li>
                    <li><a href="&#x2F;kpgb/feed.xml">RSS</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <main>
        <div class="container">
            

<div class="reading-progress" id="reading-progress">
    <div class="progress-bar" id="progress-bar"></div>
</div>


<div class="font-size-adjuster">
    <button class="font-size-btn" onclick="changeFontSize('decrease')" title="Decrease font size">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="8" y1="11" x2="14" y2="11"></line>
        </svg>
    </button>
    <span class="font-size-value" id="font-size-value">100%</span>
    <button class="font-size-btn" onclick="changeFontSize('increase')" title="Increase font size">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="11" y1="8" x2="11" y2="14"></line>
            <line x1="8" y1="11" x2="14" y2="11"></line>
        </svg>
    </button>
    <button class="font-size-btn" onclick="changeFontSize('reset')" title="Reset font size">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="1 4 1 10 7 10"></polyline>
            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
        </svg>
    </button>
</div>


<button class="zen-mode-btn" onclick="toggleZenMode()" title="Enter Zen Mode">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 2L2 7L12 12L22 7L12 2Z"></path>
        <path d="M2 17L12 22L22 17"></path>
        <path d="M2 12L12 17L22 12"></path>
    </svg>
    <span class="zen-mode-text">Zen Mode</span>
</button>

<article class="post">
    <header>
        <h1>Learn Ocaml in Y Minutes</h1>
        <div class="post-meta">
            <span class="author">By DaviRain</span>
            <span class="date">2025-07-23 00:49</span>
            
            <span class="reading-time">â±ï¸ 3 min read</span>
            
            
            <span class="category">Tech</span>
            
        </div>
        
    </header>

    
    <div class="post-with-toc">
        <aside class="toc-container">
            <nav class="toc" id="toc">
    <h2 class="toc-title">Table of Contents</h2>
    <ul class="toc-list"><li class="toc-item toc-level-2">
                <a href="#è¿›ä¸€æ­¥é˜…è¯»" class="toc-link">è¿›ä¸€æ­¥é˜…è¯»</a></li></ul></nav>
        </aside>
        <div class="post-content">
            <p>OCaml æ˜¯ä¸€ç§ç»è¿‡ä¸¥æ ¼è¯„ä¼°çš„å‡½æ•°å¼è¯­è¨€ï¼Œå…·æœ‰ä¸€äº›å‘½ä»¤å¼åŠŸèƒ½ã€‚</p>
<p>å®ƒä¸æ ‡å‡† ML åŠå…¶æ–¹è¨€ä¸€èµ·å±äº ML è¯­è¨€å®¶æ—ã€‚ F# ä¹Ÿæ·±å— OCaml çš„å½±å“ã€‚</p>
<p>å°±åƒæ ‡å‡† ML ä¸€æ ·ï¼ŒOCaml å…·æœ‰å¯äº¤äº’ä½¿ç”¨çš„è§£é‡Šå™¨å’Œç¼–è¯‘å™¨ã€‚è§£é‡Šå™¨äºŒè¿›åˆ¶æ–‡ä»¶é€šå¸¸ç§°ä¸º ocaml ï¼Œç¼–è¯‘å™¨ç§°ä¸º ocamlopt ã€‚è¿˜æœ‰ä¸€ä¸ªå­—èŠ‚ç ç¼–è¯‘å™¨ ocamlc ï¼Œä½†ä½¿ç”¨å®ƒçš„ç†ç”±å¾ˆå°‘ã€‚</p>
<p>å®ƒè¿˜åŒ…æ‹¬åŒ…ç®¡ç†å™¨ opam å’Œæ„å»ºç³»ç»Ÿ dune ã€‚</p>
<p>å®ƒæ˜¯å¼ºé™æ€ç±»å‹çš„ï¼Œä½†å®ƒä¸ä½¿ç”¨æ‰‹åŠ¨ç¼–å†™çš„ç±»å‹æ³¨é‡Šï¼Œè€Œæ˜¯ä½¿ç”¨ <a href="https://en.wikipedia.org/wiki/Hindley%E2%80%93Milner_type_system">Hindley-Milner</a>
ç®—æ³•æ¨æ–­è¡¨è¾¾å¼çš„ç±»å‹ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒä½¿å¾—ç±»å‹æ³¨é‡Šå˜å¾—ä¸å¿…è¦ï¼Œä½†å¯èƒ½æ˜¯åˆå­¦è€…å›°æƒ‘çš„ä¸€ä¸ªä¸»è¦æ ¹æºã€‚</p>
<p>å½“æ‚¨å¤„äºé¡¶å±‚å¾ªç¯æ—¶ï¼ŒOCaml å°†åœ¨æ‚¨è¾“å…¥è¡¨è¾¾å¼åæ‰“å°æ¨æ–­çš„ç±»å‹</p>
<div class="code-block-wrapper">
                <div class="code-header">
                    <span class="code-language">ocaml</span>
                    <button class="copy-button" data-code-id="code-1" onclick="copyCode('code-1')">
                        <svg class="copy-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                        <span class="copy-text">Copy</span>
                    </button>
                </div>
                <pre><code class="language-ocaml" id="code-1"># let inc x = x + 1 ;;
val inc : int -&gt; int = &lt;fun&gt;
# let a = 99 ;;
val a : int = 99
</code></pre>
            </div>
<p>å¯¹äºæºæ–‡ä»¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ ocamlc -i /path/to/file.ml å‘½ä»¤æ‰“å°æ‰€æœ‰åç§°å’Œç±»å‹ç­¾å</p>
<div class="code-block-wrapper">
                <div class="code-header">
                    <span class="code-language">bash</span>
                    <button class="copy-button" data-code-id="code-2" onclick="copyCode('code-2')">
                        <svg class="copy-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                        <span class="copy-text">Copy</span>
                    </button>
                </div>
                <pre><code class="language-bash" id="code-2">$ cat sigtest.ml
let inc x = x + 1
let add x y = x + y

let a = 1

$ ocamlc -i ./sigtest.ml
val inc : int -&gt; int
val add : int -&gt; int -&gt; int
val a : int
</code></pre>
            </div>
<p>è¯·æ³¨æ„ï¼Œå¤šä¸ªå‚æ•°çš„å‡½æ•°çš„ç±»å‹ç­¾åä»¥<a href="https://en.wikipedia.org/wiki/Currying">æŸ¯é‡ŒåŒ–</a>å½¢å¼ç¼–å†™ã€‚å¸¦æœ‰å¤šä¸ªå‚æ•°çš„å‡½æ•°å¯ä»¥è¡¨ç¤ºä¸ºä»…å¸¦æœ‰ä¸€ä¸ªå‚æ•°çš„å‡½æ•°çš„ç»„åˆã€‚ä¸Šä¾‹ä¸­åº”ç”¨äºå‚æ•° 2 å’Œ 3 çš„ f(x,y) = x + y å‡½æ•°ç›¸å½“äºåº”ç”¨äº 3 çš„ f0(y) = 2 + y å‡½æ•°ã€‚å› æ­¤æœ‰ int -&gt; int -&gt; int ç­¾åã€‚</p>
<div class="code-block-wrapper">
                <div class="code-header">
                    <span class="code-language">ocaml</span>
                    <button class="copy-button" data-code-id="code-3" onclick="copyCode('code-3')">
                        <svg class="copy-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                        <span class="copy-text">Copy</span>
                    </button>
                </div>
                <pre><code class="language-ocaml" id="code-3">(*** æ³¨é‡Š ***)

(*
  åœ¨OCamlä¸­ï¼Œæ³¨é‡Šæ˜¯ç”¨ (* å’Œ *) æ¥åŒ…å›´çš„ã€‚OCamlæ”¯æŒåµŒå¥—æ³¨é‡Šï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨ä¸€ä¸ªæ³¨é‡Šå—ä¸­åŒ…å«å¦ä¸€ä¸ªæ³¨é‡Šå—
*)

(*
  è¿™æ˜¯ä¸€ä¸ªåµŒå¥—æ³¨é‡Šçš„ç¤ºä¾‹
  (* è¿™æ˜¯åµŒå¥—çš„æ³¨é‡Š *)
  è¿™é‡Œæ˜¯å¤–å±‚æ³¨é‡Šçš„ç»§ç»­
*)

(*
  åœ¨OCamlä¸­ï¼Œç¡®å®æ²¡æœ‰å•è¡Œæ³¨é‡Šçš„è¯­æ³•ã€‚æ‰€æœ‰çš„æ³¨é‡Šéƒ½ä½¿ç”¨ (* ... *) çš„å½¢å¼ï¼Œå¹¶ä¸”å¯ä»¥è·¨å¤šè¡Œ
*)

(*** å˜é‡ä¸å‡½æ•° ***)

(*
  åœ¨OCamlä¸­ï¼Œè¡¨è¾¾å¼å¯ä»¥ç”¨åŒåˆ†å· ;; æ¥åˆ†éš”ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œè¿™ç§ç”¨æ³•æ˜¯å¤šä½™çš„ï¼Œä½†åœ¨ä¸€äº›æ•™ç¨‹ä¸­ï¼Œ
  ä¸ºäº†æ–¹ä¾¿å°†ä»£ç ç²˜è´´åˆ°è§£é‡Šå™¨ï¼ˆREPLï¼‰ä¸­ï¼Œä¼šåœ¨æ¯ä¸ªè¡¨è¾¾å¼åä½¿ç”¨ ;;ã€‚
  ç„¶è€Œï¼Œåœ¨å®é™…çš„æºä»£ç æ–‡ä»¶ä¸­ï¼Œä¸å¿…è¦åœ°ä½¿ç”¨è¡¨è¾¾å¼åˆ†éš”ç¬¦é€šå¸¸è¢«è®¤ä¸ºæ˜¯ä¸å¥½çš„ç¼–ç¨‹é£æ ¼ã€‚
*)

(*
  åœ¨OCamlä¸­ï¼Œå˜é‡å’Œå‡½æ•°çš„å£°æ˜ä½¿ç”¨ let å…³é”®å­—ã€‚è¿™ä½¿å¾—OCamlçš„å£°æ˜è¯­æ³•éå¸¸ç®€æ´å’Œä¸€è‡´ã€‚
*)
(*
  åœ¨OCamlä¸­ï¼Œå˜é‡é»˜è®¤æ˜¯ä¸å¯å˜çš„ï¼ˆimmutableï¼‰ã€‚è¿™æ„å‘³ç€ä¸€æ—¦ä¸ºå˜é‡èµ‹å€¼ï¼Œå°±ä¸èƒ½å†æ”¹å˜å®ƒçš„å€¼ã€‚è¿™ç§ä¸å¯å˜æ€§æœ‰åŠ©äºç¡®ä¿ç¨‹åºçš„æ­£ç¡®æ€§å’Œå¯é¢„æµ‹æ€§ã€‚
*)
let x = 10;;
(* print_endline (string_of_int x);; *)
Printf.printf "x = %d\n" x;;

(*
  åœ¨OCamlä¸­ï¼Œå˜é‡åå¯ä»¥åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿å­—ç¬¦ï¼Œä½†å¿…é¡»ä»¥å­—æ¯æˆ–ä¸‹åˆ’çº¿å­—ç¬¦å¼€å¤´ã€‚
  å¦å¤–ï¼ŒOCamlå¯¹å¤§å°å†™æ•æ„Ÿï¼Œå› æ­¤å˜é‡åä¸­çš„å¤§å°å†™å­—ç¬¦æ˜¯æœ‰åŒºåˆ«çš„ã€‚
*)

(*
  OCamlç¡®å®å…è®¸åœ¨æ ‡è¯†ç¬¦ä¸­ä½¿ç”¨å•å¼•å·å­—ç¬¦ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå•å¼•å·å¹¶æ²¡æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œå®ƒé€šå¸¸ç”¨äºé‚£äº›åœ¨å…¶ä»–è¯­è¨€ä¸­ä¼šä½¿ç”¨è¯¸å¦‚â€œfoo_tmpâ€ä¹‹ç±»åå­—çš„æƒ…å†µã€‚
*)
let foo = 1;;
let foo' = foo * 2;;
(* print_endline (string_of_int foo');; *)
Printf.printf "foo' = %d\n" foo';;

(*
  åœ¨OCamlä¸­ï¼Œç¼–è¯‘å™¨èƒ½å¤Ÿè‡ªåŠ¨æ¨æ–­ç±»å‹ï¼Œå› æ­¤é€šå¸¸ä¸éœ€è¦æ˜¾å¼æŒ‡å®šå‚æ•°ç±»å‹ã€‚ç„¶è€Œï¼Œå¦‚æœä½ å¸Œæœ›æˆ–éœ€è¦ï¼Œä½ ä¹Ÿå¯ä»¥æ˜¾å¼åœ°æŒ‡å®šå‚æ•°ç±»å‹ã€‚
*)
let inc_int (x: int): int = x + 1;;
(* print_endline (string_of_int (inc_int 1));; *)
Printf.printf "inc_int 1 = %d\n" (inc_int 1);;

(*
  ç¡®å®ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ˜¾å¼ç±»å‹æ³¨è§£æ˜¯å¿…è¦çš„ï¼Œç‰¹åˆ«æ˜¯åœ¨è§£å†³ä¸¤ä¸ªå…·æœ‰ç›¸åŒå­—æ®µåç§°çš„è®°å½•ç±»å‹ä¹‹é—´çš„æ­§ä¹‰æ—¶ã€‚
  å¦ä¸€ç§é€‰æ‹©æ˜¯å°†è¿™äº›ç±»å‹å°è£…åœ¨æ¨¡å—ä¸­ï¼Œä½†è¿™ä¸¤ä¸ªä¸»é¢˜éƒ½è¶…å‡ºäº†æœ¬æ•™ç¨‹çš„è®¨è®ºèŒƒå›´ã€‚
*)

(*
  åœ¨OCamlä¸­ï¼Œé€’å½’å‡½æ•°å®šä¹‰éœ€è¦ä½¿ç”¨ rec å…³é”®å­—è¿›è¡Œæ ‡è®°ã€‚
    è¿™æ˜¯å› ä¸ºOCamlé‡‡ç”¨äº†é™æ€ä½œç”¨åŸŸè§„åˆ™ï¼Œä¸ºäº†æ˜ç¡®è¡¨ç¤ºä¸€ä¸ªå‡½æ•°æ˜¯é€’å½’çš„ï¼Œéœ€è¦æ˜¾å¼åœ°ä½¿ç”¨ rec å…³é”®å­—ã€‚
*)
let rec factorial n =
  if n = 0 then 1
  else n * factorial (n - 1);;
(* print_endline (string_of_int (factorial 5));; *)
Printf.printf "factorial 5 = %d\n" (factorial 5);;

(*
  åœ¨OCamlä¸­ï¼Œå‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œè¿™æ„å‘³ç€å‡½æ•°å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºè¿”å›å€¼è¿”å›ã€‚
  è¿™ç§ç‰¹æ€§ä½¿å¾—OCamléå¸¸é€‚åˆå‡½æ•°å¼ç¼–ç¨‹èŒƒå¼ï¼Œå› ä¸ºå‡½æ•°å¯ä»¥è¢«è§†ä¸ºæ•°æ®ï¼Œå¯ä»¥è¢«æ“ä½œå’Œç»„åˆã€‚
*)

(*
  åœ¨OCamlä¸­ï¼Œå‡½æ•°åº”ç”¨é€šå¸¸ä¸éœ€è¦åœ¨å‚æ•°å‘¨å›´ä½¿ç”¨æ‹¬å·ã€‚è¿™ä½¿å¾—å‡½æ•°è°ƒç”¨çš„è¯­æ³•æ›´åŠ ç®€æ´å’Œè‡ªç„¶ã€‚
*)
let fact_5 = factorial 5;;
(* print_endline (string_of_int fact_5);; *)
Printf.printf "factorial 5 = %d\n" fact_5;;

(*
  æ­£ç¡®ï¼Œåœ¨OCamlä¸­ï¼Œå‡½æ•°åº”ç”¨é€šå¸¸ä¸éœ€è¦åœ¨å‚æ•°å‘¨å›´ä½¿ç”¨æ‹¬å·ï¼Œé™¤éå‚æ•°æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ‹¬å·å¯ä»¥æ˜ç¡®è¡¨è¾¾å¼çš„è¾¹ç•Œï¼Œé¿å…æ­§ä¹‰ã€‚
*)
let fact_4 = factorial (2 + 2);;
(* print_endline (string_of_int fact_4);; *)
Printf.printf "factorial 4 = %d\n" fact_4;;

(*
  åœ¨OCamlä¸­ï¼Œå‡½æ•°å¯ä»¥æœ‰å¤šä¸ªå‚æ•°ï¼Œè¿™äº›å‚æ•°å¯ä»¥ç”¨ç©ºæ ¼åˆ†éš”ã€‚è¿™ç§è¯­æ³•ä½¿å¾—å‡½æ•°è°ƒç”¨æ›´åŠ ç®€æ´å’Œè‡ªç„¶ã€‚
*)

(*
  åœ¨OCamlä¸­ï¼Œæ¯ä¸ªå‡½æ•°å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªå‚æ•°ã€‚ç„¶è€Œï¼Œæœ‰äº›å‡½æ•°åœ¨æ¦‚å¿µä¸Šä¸éœ€è¦ä»»ä½•å‚æ•°ã€‚
  ä¸ºäº†å¤„ç†è¿™ç§æƒ…å†µï¼ŒOCamlæä¾›äº†ä¸€ä¸ªç‰¹æ®Šçš„ç±»å‹ï¼Œç§°ä¸º unit ç±»å‹ã€‚unit ç±»å‹åªæœ‰ä¸€ä¸ªå€¼ï¼Œå†™ä½œ ()ã€‚
*)
let print_hello () = print_endline "Hello, World!";;

(*
  åœ¨OCamlä¸­ï¼Œå½“è°ƒç”¨ä¸€ä¸ªæ¥å— unit ç±»å‹å‚æ•°çš„å‡½æ•°æ—¶ï¼Œä½ å¿…é¡»æ˜¾å¼åœ°ä¼ é€’ () ä½œä¸ºå‚æ•°ã€‚è¿™æ˜¯å› ä¸º unit ç±»å‹è¡¨ç¤ºâ€œæ— å®é™…å€¼â€ï¼Œä½†ä»ç„¶éœ€è¦æ»¡è¶³å‡½æ•°ç­¾åçš„è¦æ±‚ã€‚
*)
print_hello () ;;

(*
  åœ¨OCamlä¸­ï¼Œå‡½æ•°è°ƒç”¨æ˜¯æŸ¯é‡ŒåŒ–ï¼ˆcurryingï¼‰çš„ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªå‡½æ•°å®é™…ä¸Šåªæ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—ä¸‹ä¸€ä¸ªå‚æ•°ã€‚
  ç”±äºè¿™ç§ç‰¹æ€§ï¼Œå½“ä½ è°ƒç”¨ä¸€ä¸ªå‡½æ•°ä½†æä¾›çš„å‚æ•°ä¸è¶³æ—¶ï¼Œä¸ä¼šå¯¼è‡´é”™è¯¯ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œç­‰å¾…å‰©ä½™çš„å‚æ•°ã€‚
*)
let make_inc x y = x + y;; (* make_inc is int -&gt; int -&gt; int *)
let inc_2 = make_inc 2;; (* inc_2 is int -&gt; int *)
(* print_endline (string_of_int (inc_2 3));; *)
Printf.printf "inc_2 3 = %d\n" (inc_2 3);;

(*
  åœ¨OCamlä¸­ï¼Œå‡½æ•°è°ƒç”¨æ˜¯æŸ¯é‡ŒåŒ–çš„ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªå‡½æ•°å®é™…ä¸Šåªæ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—ä¸‹ä¸€ä¸ªå‚æ•°ã€‚
  ç”±äºè¿™ç§ç‰¹æ€§ï¼Œä½ å¯ä»¥ä½¿ç”¨éƒ¨åˆ†åº”ç”¨ï¼ˆpartial applicationï¼‰æ¥åˆ›å»ºæ–°çš„å‡½æ•°ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸å¼ºå¤§çš„æŠ€æœ¯ã€‚
*)

(*
  åœ¨OCamlä¸­ï¼Œå‡½æ•°ä½“å¯ä»¥åŒ…å«å¤šä¸ªè¡¨è¾¾å¼ï¼Œå…¶ä¸­æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼å°†ä½œä¸ºå‡½æ•°çš„è¿”å›å€¼ã€‚
  æ‰€æœ‰å…¶ä»–çš„è¡¨è¾¾å¼å¿…é¡»æ˜¯ unit ç±»å‹ã€‚è¿™ç§ç‰¹æ€§åœ¨ç¼–å†™å‘½ä»¤å¼é£æ ¼ä»£ç æ—¶éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚æ’å…¥è°ƒè¯•æ‰“å°è¯­å¥ã€‚
*)
let print_and_return x =
  print_endline (string_of_int x);
  x
;;
(* print_endline (string_of_int (print_and_return 42));; *)
Printf.printf "print_and_return 42 = %d\n" (print_and_return 42);;

(*
  åœ¨OCamlä¸­ï¼Œå‡½æ•°ä½“å¯ä»¥åŒ…å«å¤šä¸ªè¡¨è¾¾å¼ï¼Œå…¶ä¸­æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼å°†ä½œä¸ºå‡½æ•°çš„è¿”å›å€¼ã€‚
  æ‰€æœ‰å…¶ä»–çš„è¡¨è¾¾å¼å¿…é¡»æ˜¯ unit ç±»å‹ã€‚è¿™ç§ç‰¹æ€§åœ¨ç¼–å†™å‘½ä»¤å¼é£æ ¼ä»£ç æ—¶éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚æ’å…¥è°ƒè¯•æ‰“å°è¯­å¥ã€‚
*)

(*
  åœ¨OCamlä¸­ï¼Œä½œä¸ºä¸€ç§å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ï¼Œç¡®å®æ²¡æœ‰ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„â€œè¿‡ç¨‹â€æˆ–è€…â€œå­ç¨‹åºâ€ã€‚
  æ¯ä¸ªå‡½æ•°éƒ½å¿…é¡»è¿”å›ä¸€ä¸ªå€¼ã€‚å¯¹äºé‚£äº›ä¸»è¦æ˜¯ä¸ºäº†å‰¯ä½œç”¨è€Œè°ƒç”¨çš„å‡½æ•°ï¼Œä¾‹å¦‚ print_endlineï¼Œå®ƒä»¬è¿”å›ä¸€ä¸ª unit ç±»å‹çš„å€¼ã€‚
*)

(*
  åœ¨OCamlä¸­ï¼Œå¯ä»¥ä½¿ç”¨ let ... in ç»“æ„æ¥é“¾å¼å®šä¹‰å¤šä¸ªå˜é‡ï¼Œç„¶ååœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨å®ƒä»¬ã€‚
  è¿™ç±»ä¼¼äºåœ¨å‘½ä»¤å¼è¯­è¨€ä¸­å°†å€¼èµ‹ç»™å¤šä¸ªå˜é‡ï¼Œç„¶ååœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨è¿™äº›å˜é‡ã€‚
*)
let z = let x = 10 in
let y = 20 in
x + y;;
(* print_endline (string_of_int z);; *)
Printf.printf "z = %d\n" z;;

(*
  åœ¨OCamlä¸­ï¼Œå¯ä»¥ä½¿ç”¨ let ... in ç»“æ„æ¥é“¾å¼å®šä¹‰å¤šä¸ªå˜é‡ï¼Œç„¶ååœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨å®ƒä»¬ã€‚
  è¿™ç±»ä¼¼äºåœ¨å‘½ä»¤å¼è¯­è¨€ä¸­å°†å€¼èµ‹ç»™å¤šä¸ªå˜é‡ï¼Œç„¶ååœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨è¿™äº›å˜é‡ã€‚
*)

(*
  åœ¨OCamlä¸­ï¼Œé™¤äº†ä½¿ç”¨é“¾å¼çš„ let ... in ç»“æ„ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ let ... and ... in ç»“æ„æ¥åŒæ—¶å®šä¹‰å¤šä¸ªå˜é‡æˆ–å‡½æ•°ã€‚
  è¿™åœ¨å®šä¹‰ç›¸äº’é€’å½’çš„å‡½æ•°æ—¶ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºä½¿ç”¨æ™®é€šçš„ let ... in ç»“æ„ä¼šå¯¼è‡´ç¼–è¯‘å™¨æŠ¥é”™ï¼ŒæŒ‡å‡ºå­˜åœ¨æœªç»‘å®šçš„å€¼ã€‚
*)
let rec
  is_even n = n = 0 || is_odd (n - 1)
and
  is_odd n = n &lt;&gt; 0 &amp;&amp; is_even (n - 1);; (* åœ¨OCamlä¸­ï¼Œ&lt;&gt; æ˜¯ä¸ç­‰äºæ“ä½œç¬¦ï¼Œç”¨äºæ¯”è¾ƒä¸¤ä¸ªå€¼æ˜¯å¦ä¸ç›¸ç­‰ã€‚å®ƒç±»ä¼¼äºå…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­çš„ != æ“ä½œç¬¦ã€‚ *)
(* print_endline (string_of_bool (is_even 5));; *)
Printf.printf "is_even 5 = %b\n" (is_even 5);;


(*
è§£é‡Š:
  is_even å‡½æ•°ï¼š
    å¦‚æœ n ç­‰äº 0ï¼Œåˆ™è¿”å› trueï¼ˆn = 0ï¼‰ã€‚
    å¦åˆ™ï¼Œè°ƒç”¨ is_odd å‡½æ•°ï¼Œä¼ é€’ n - 1 ä½œä¸ºå‚æ•°ã€‚
  is_odd å‡½æ•°ï¼š
    å¦‚æœ n ä¸ç­‰äº 0ï¼ˆn &lt;&gt; 0ï¼‰ï¼Œåˆ™è¿”å› trueï¼Œå¹¶é€’å½’è°ƒç”¨ is_even å‡½æ•°ï¼Œä¼ é€’ n - 1 ä½œä¸ºå‚æ•°ã€‚
    å¦åˆ™ï¼Œè¿”å› falseã€‚
*)

(*
let rec
  is_even = function
    | 0 -&gt; true
    | n -&gt; is_odd (n - 1)
and
  is_odd = function
    | 0 -&gt; false
    | n -&gt; is_even (n - 1)
;;
*)

(* åœ¨OCamlä¸­ï¼ŒåŒ¿åå‡½æ•°ï¼ˆä¹Ÿç§°ä¸ºlambdaè¡¨è¾¾å¼ï¼‰*)
let my_lambda = fun x -&gt; x * x;;
(* print_endline (string_of_int (my_lambda 5));; *)
Printf.printf "my_lambda 5 = %d\n" (my_lambda 5);;

(*
  åœ¨OCamlä¸­ï¼ŒåŒ¿åå‡½æ•°çš„è¯­æ³•æ˜¯ fun x -&gt; exprï¼Œå…¶ä¸­ x æ˜¯å‚æ•°ï¼Œexpr æ˜¯å‡½æ•°ä½“ã€‚
  ä¸æ™®é€šå‡½æ•°ä¸åŒï¼ŒåŒ¿åå‡½æ•°ä¸éœ€è¦æ˜¾å¼åœ°æŒ‡å®šå‚æ•°ç±»å‹ï¼Œå› ä¸ºOCamlå¯ä»¥ä»ä¸Šä¸‹æ–‡ä¸­æ¨æ–­å‡ºå‚æ•°ç±»å‹ã€‚
  ä½†æ˜¯ï¼Œå¦‚æœä½ æƒ³æ˜¾å¼åœ°æŒ‡å®šå‚æ•°ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨æ‹¬å·å°†å‚æ•°ç±»å‹æ‹¬èµ·æ¥ï¼Œä¾‹å¦‚ fun (x: int) -&gt; exprã€‚
*)

(*** æ“ä½œç¬¦ ***)

(*
  åœ¨OCamlä¸­ï¼Œæ“ä½œç¬¦å’Œå‡½æ•°ä¹‹é—´çš„åŒºåˆ«å¾ˆå°ã€‚å®é™…ä¸Šï¼Œæ¯ä¸ªæ“ä½œç¬¦éƒ½å¯ä»¥ä½œä¸ºå‡½æ•°è°ƒç”¨ã€‚
  è¿™ç§ç‰¹æ€§ä½¿å¾—OCamlçš„æ“ä½œç¬¦éå¸¸çµæ´»ï¼Œå¯ä»¥åœ¨éœ€è¦å‡½æ•°çš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨æ“ä½œç¬¦ã€‚
*)

(+) 3 4 (* Same as 3 + 4 *);;
Printf.printf "3 + 4 = %d\n" ((+) 3 4);;

(*
  åœ¨OCamlä¸­ï¼Œæ“ä½œç¬¦å’Œå‡½æ•°ä¹‹é—´çš„åŒºåˆ«å¾ˆå°ã€‚å®é™…ä¸Šï¼Œæ¯ä¸ªæ“ä½œç¬¦éƒ½å¯ä»¥ä½œä¸ºå‡½æ•°è°ƒç”¨ã€‚
  è¿™ç§ç‰¹æ€§ä½¿å¾—OCamlçš„æ“ä½œç¬¦éå¸¸çµæ´»ï¼Œå¯ä»¥åœ¨éœ€è¦å‡½æ•°çš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨æ“ä½œç¬¦ã€‚
*)

(*
  åœ¨OCamlä¸­ï¼Œæ•´æ•°å’Œæµ®ç‚¹æ•°ä¹‹é—´æ²¡æœ‰éšå¼è½¬æ¢ã€‚æ›´æœ‰è¶£çš„æ˜¯ï¼ŒOCamlä½¿ç”¨ä¸åŒçš„æ“ä½œç¬¦æ¥å¤„ç†æµ®ç‚¹æ•°è¿ç®—ã€‚
  è¿™ç§è®¾è®¡å†³ç­–æœ‰åŠ©äºé¿å…ç”±äºç±»å‹è½¬æ¢è€Œå¯¼è‡´çš„æ½œåœ¨é”™è¯¯ï¼Œå¹¶ç¡®ä¿ç¨‹åºçš„ç±»å‹å®‰å…¨æ€§ã€‚
*)

(* 12 + 3;; (* int addition *) *)
Printf.printf "12 + 3 = %d\n" (12 + 3);;
(* 12.0 +. 3.0;; (* float addition *) *)
Printf.printf "12.0 + 3.0 = %f\n" (12.0 +. 3.0);;
(* 12 / 3 ;; (* Integer division. *) *)
Printf.printf "12 / 3 = %d\n" (12 / 3);;
(* 12.0 /. 3.0 ;; (* Floating point division. *) *)
Printf.printf "12.0 / 3.0 = %f\n" (12.0 /. 3.0);;
(* 5 mod 2 ;; (* Remainder. *) *)
Printf.printf "5 mod 2 = %d\n" (5 mod 2);;


(*
  åœ¨OCamlä¸­ï¼Œä¸€å…ƒè´Ÿå·ï¼ˆunary minusï¼‰æ˜¯ä¸€ä¸ªæ˜¾è‘—çš„ä¾‹å¤–ï¼Œå®ƒæ˜¯å¤šæ€çš„ã€‚
  è¿™æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨ç›¸åŒçš„ - æ“ä½œç¬¦æ¥è¡¨ç¤ºæ•´æ•°å’Œæµ®ç‚¹æ•°çš„è´Ÿå€¼ã€‚
  ç„¶è€Œï¼ŒOCamlä¹Ÿæä¾›äº†ä¸“é—¨ç”¨äºæ•´æ•°å’Œæµ®ç‚¹æ•°çš„ä¸€å…ƒè´Ÿå·å½¢å¼ã€‚
*)
(* - 3 ;; (* Polymorphic, integer *) *)
Printf.printf "-3 = %d\n" (- 3);;
- 4.5 ;; (* Polymorphic, float *)
Printf.printf "-4.5 = %f\n" (- 4.5);;
(* ~- 3 (* Integer only *) *)
Printf.printf "~-3 = %d\n" (~- 3);;
(* ~- 3.4 (* Type error *) *)
(* Printf.printf "~- 3.4 = %f\n" ( ~- 3.4);; *)
(* ~-. 3.4 (* Float only *);; *)
Printf.printf "~-.3.4 = %f\n" ( ~-. 3.4);;

(*
  åœ¨OCamlä¸­ï¼Œä½ å¯ä»¥å®šä¹‰è‡ªå·±çš„æ“ä½œç¬¦æˆ–é‡æ–°å®šä¹‰ç°æœ‰çš„æ“ä½œç¬¦ã€‚
  ä¸Standard MLæˆ–Haskellä¸åŒï¼ŒOCamlä¸­åªæœ‰æŸäº›ç¬¦å·å¯ä»¥ç”¨äºæ“ä½œç¬¦åç§°ï¼Œ
  å¹¶ä¸”æ“ä½œç¬¦çš„é¦–ä¸ªç¬¦å·å†³å®šäº†å…¶ç»“åˆæ€§å’Œä¼˜å…ˆçº§è§„åˆ™ã€‚
*)
(* let (+) a b = a - b ;; (* Surprise maintenance programmers. *) *)
(* print_endline (string_of_int (3 + 4));; *)
(* Printf.printf "3 + 4 = %d\n" (3 + 4);; *)

(*
  å®šä¹‰ä¸€ä¸ªç”¨äºæµ®ç‚¹æ•°çš„å€’æ•°æ“ä½œç¬¦æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„ä¾‹å­ã€‚åœ¨OCamlä¸­ï¼Œä¸€å…ƒæ“ä½œç¬¦å¿…é¡»ä»¥ ~ å¼€å¤´ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªæ–°çš„æ“ä½œç¬¦ ~% æ¥è¡¨ç¤ºæµ®ç‚¹æ•°çš„å€’æ•°ã€‚
*)
let (~/) x = 1.0 /. x ;;
(* ~/4.0 (* = 0.25 *);; *)
(* print_endline (string_of_float (~/4.0));; *)
Printf.printf "~/.4.0 = %f\n" (~/4.0);;

(*** Built-in data structures ***)

(*
  åœ¨OCamlä¸­ï¼Œåˆ—è¡¨ï¼ˆListsï¼‰ä½¿ç”¨æ–¹æ‹¬å· [] æ‹¬èµ·æ¥ï¼Œåˆ—è¡¨é¡¹ä¹‹é—´ç”¨åˆ†å· ; åˆ†éš”ã€‚
*)
let my_list = [1; 2; 3; 4; 5];; (* Has type "int list" *)
(* print_endline (string_of_int (List.length my_list));; *)
Printf.printf "List.length my_list = %d\n" (List.length my_list);;

(* æ‰“å°æ¯ä¸ªå…ƒç´  *)
List.iter (fun x -&gt; Printf.printf "%d " x) my_list;;

(*
åœ¨OCamlä¸­ï¼Œå…ƒç»„ï¼ˆTuplesï¼‰å¯ä»¥ï¼ˆå¯é€‰åœ°ï¼‰ç”¨åœ†æ‹¬å· () æ‹¬èµ·æ¥ï¼Œå…ƒç»„ä¸­çš„é¡¹ç”¨é€—å· , åˆ†éš”ã€‚å…ƒç»„æ˜¯ä¸€ç§å›ºå®šå¤§å°ã€ä¸åŒç±»å‹çš„é›†åˆã€‚
*)
let first_tuple = 3, 4;; (* Has type "int * int" *)
let second_tuple = (3, 4);;

(* let third_tuple = (3, "hello", 4.5);; (* Has type "int * string * float" *) *)
(* print_endline (string_of_int (fst first_tuple));; *)
(* print_endline (string_of_int (snd first_tuple));; *)
(* print_endline (string_of_int (fst second_tuple));; *)
(* print_endline (string_of_int (snd second_tuple));; *)

(* æ‰“å°å…ƒç»„ *)
Printf.printf "fst first_tuple = %d\n" (fst first_tuple);;
Printf.printf "snd first_tuple = %d\n" (snd first_tuple);;
Printf.printf "fst second_tuple = %d\n" (fst second_tuple);;
Printf.printf "snd second_tuple = %d\n" (snd second_tuple);;


(*
  åœ¨OCamlä¸­ï¼Œå¦‚æœä½ å°è¯•ç”¨é€—å· , æ¥åˆ†éš”åˆ—è¡¨é¡¹ï¼Œä½ å°†å¾—åˆ°ä¸€ä¸ªåŒ…å«å…ƒç»„çš„åˆ—è¡¨ï¼Œè¿™é€šå¸¸ä¸æ˜¯ä½ æ‰€æœŸæœ›çš„ç»“æœã€‚
*)
let bad_list = [1, 2; 3, 4];; (* Has type "(int * int) list" *)
(* print_endline (string_of_int (List.length bad_list));; *)
Printf.printf "List.length bad_list = %d\n" (List.length bad_list);;

(* æ‰“å°æ¯ä¸ªå…ƒç»„ *)

List.iter (fun (x, y) -&gt; Printf.printf "(%d, %d) " x y) bad_list;;


(*
  å¦‚æœä½ å°è¯•å°†ä¸€ä¸ªå…ƒç»„æ¨¡å¼åŒ¹é…åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­ï¼Œä½ å°†å¾—åˆ°ä¸€ä¸ªç±»å‹é”™è¯¯ã€‚
  ä¸ºäº†åŒ¹é…ä¸€ä¸ªå…ƒç»„ï¼Œä½ éœ€è¦å°†å…¶æ‹¬èµ·æ¥ï¼Œå°±åƒä½ åœ¨å®šä¹‰å…ƒç»„æ—¶æ‰€åšçš„é‚£æ ·ã€‚
*)

print_endline "";;

let incorrect_list = [1, 2, 3]

(* æ‰“å°ä¸¤ä¸ªåˆ—è¡¨ *)
let () =
  match incorrect_list with
  | [(a, b, c)] -&gt; Printf.printf "Incorrect list: (%d, %d, %d)\n" a b c
  | _ -&gt; Printf.printf "Incorrect list does not match expected pattern\n"

(*
  åœ¨OCamlä¸­ï¼Œæ•°ç»„ï¼ˆArraysï¼‰ä½¿ç”¨ [| å’Œ |] æ‹¬èµ·æ¥ï¼Œæ•°ç»„é¡¹ä¹‹é—´ç”¨åˆ†å· ; åˆ†éš”ã€‚
  ä¸åˆ—è¡¨ä¸åŒï¼Œæ•°ç»„æ˜¯å¯å˜çš„ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨æ•°ç»„ä¸­æ·»åŠ ã€åˆ é™¤æˆ–æ›´æ–°å…ƒç´ ã€‚
*)

(*
  å¦‚æœåœ¨OCamlä¸­è¯•å›¾ç”¨é€—å· , æ¥åˆ†éš”åˆ—è¡¨é¡¹ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªåŒ…å«å…ƒç»„çš„åˆ—è¡¨ï¼Œè¿™é€šå¸¸ä¸æ˜¯ä½ æ‰€æœŸæœ›çš„ç»“æœã€‚
*)
let bad_list = [1, 2];; (* Has type "(int * int) list" *)
(* print_endline (string_of_int (List.length bad_list));; *)
Printf.printf "List.length bad_list = %d\n" (List.length bad_list);;

(* æ‰“å°æ¯ä¸ªå…ƒç»„ *)
List.iter (fun (x, y) -&gt; Printf.printf "(%d, %d) " x y) bad_list;;

print_endline "";;

(*
  åœ¨OCamlä¸­ï¼Œå¯ä»¥ä½¿ç”¨ List.nth å‡½æ•°æ¥è®¿é—®åˆ—è¡¨ä¸­çš„å•ä¸ªå…ƒç´ ã€‚List.nth å‡½æ•°æ¥æ”¶ä¸€ä¸ªåˆ—è¡¨å’Œä¸€ä¸ªç´¢å¼•ï¼Œè¿”å›è¯¥ç´¢å¼•å¤„çš„å…ƒç´ ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒOCamlåˆ—è¡¨çš„ç´¢å¼•æ˜¯ä»0å¼€å§‹çš„ã€‚
*)
Printf.printf "List.nth my_list 1 = %d\n" (List.nth my_list 1);;

(*
  åœ¨OCamlä¸­ï¼Œåˆ—è¡¨æ“ä½œéå¸¸å¼ºå¤§ï¼Œå°¤å…¶æ˜¯é€šè¿‡é«˜é˜¶å‡½æ•°ï¼ˆhigher-order functionsï¼‰å¦‚ map å’Œ filter å¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œåˆ—è¡¨å¤„ç†ã€‚
*)

let result_list = List.map (fun x -&gt; x * 2) my_list;;
let rl = List.filter (fun x -&gt; x mod 2 = 0) my_list;;

(* æ‰“å°æ¯ä¸ªå…ƒç´  *)
List.iter (fun x -&gt; Printf.printf "%d " x) result_list;;
print_endline "";;

(* æ‰“å°æ¯ä¸ªå…ƒç´  *)
List.iter (fun x -&gt; Printf.printf "%d " x) rl;;
print_endline "";;

(*
  åœ¨OCamlä¸­ï¼Œå¯ä»¥ä½¿ç”¨ :: æ„é€ ç¬¦ï¼ˆé€šå¸¸ç§°ä¸º "cons"ï¼‰å°†ä¸€ä¸ªå…ƒç´ æ·»åŠ åˆ°åˆ—è¡¨çš„å¼€å¤´ã€‚è¿™ä¸ªæ“ä½œæ˜¯éå¸¸å¸¸è§çš„åŸºæœ¬åˆ—è¡¨æ“ä½œã€‚
*)

let new_list = 1 :: [2; 3];;
(* æ‰“å°æ¯ä¸ªå…ƒç´  *)
List.iter (fun x -&gt; Printf.printf "%d " x) new_list;;
print_endline "";;

(*
  :: æ„é€ ç¬¦åªèƒ½å°†å•ä¸ªå…ƒç´ æ·»åŠ åˆ°åˆ—è¡¨çš„å¼€å¤´ã€‚å¦‚æœéœ€è¦å°†ä¸¤ä¸ªåˆ—è¡¨ç»“åˆèµ·æ¥ï¼Œéœ€è¦ä½¿ç”¨ @ æ“ä½œç¬¦ï¼Œå®ƒå¯ä»¥å°†ä¸¤ä¸ªåˆ—è¡¨è¿æ¥æˆä¸€ä¸ªæ–°çš„åˆ—è¡¨ã€‚
*)

let combined_list = [1; 2] @ [3; 4];;
(* æ‰“å°æ¯ä¸ªå…ƒç´  *)
List.iter (fun x -&gt; Printf.printf "%d " x) combined_list;;
print_endline "";;

(*
  åœ¨OCamlä¸­ï¼Œå¯ä»¥ä½¿ç”¨ List.rev å‡½æ•°æ¥åè½¬åˆ—è¡¨ä¸­çš„å…ƒç´ ã€‚
*)

let reversed_list = List.rev my_list;;
(* æ‰“å°æ¯ä¸ªå…ƒç´  *)
List.iter (fun x -&gt; Printf.printf "%d " x) reversed_list;;
print_endline "";;

(*
  åœ¨OCamlä¸­ï¼Œæ•°ç»„ï¼ˆarraysï¼‰æ˜¯ä¸€ç§å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥é€šè¿‡ |[]| è¯­æ³•æ¥å®šä¹‰å’Œè®¿é—®ã€‚ä¸åˆ—è¡¨ä¸åŒï¼Œæ•°ç»„å…è®¸ä½ åœ¨å¸¸æ•°æ—¶é—´å†…éšæœºè®¿é—®å’Œä¿®æ”¹å…ƒç´ ã€‚
*)
let my_array = [|1; 2; 3|];;

(* æ‰“å°æ¯ä¸ªå…ƒç´  *)
Array.iter (fun x -&gt; Printf.printf "%d " x) my_array;;
print_endline "";;

(*
  åœ¨OCamlä¸­ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•æ¥è®¿é—®å’Œä¿®æ”¹æ•°ç»„ä¸­çš„å…ƒç´ ã€‚æ•°ç»„çš„ç´¢å¼•ä»0å¼€å§‹ï¼Œä½¿ç”¨ array.(index) è¯­æ³•æ¥è¿›è¡Œè®¿é—®å’Œä¿®æ”¹ã€‚
*)

Printf.printf "my_array.(1) = %d\n" my_array.(1);;

(*** Strings and characters ***)

(*
  åœ¨OCamlä¸­ï¼Œå­—ç¬¦ä¸²ï¼ˆstringsï¼‰æ˜¯ä¸€ç§ä¸å¯å˜çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥é€šè¿‡ "..." è¯­æ³•æ¥å®šä¹‰ã€‚å­—ç¬¦ä¸²æ˜¯ç”±å­—ç¬¦ç»„æˆçš„åˆ—è¡¨ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•æ¥è®¿é—®å’Œä¿®æ”¹ã€‚
*)
let my_str = "Hello world!";;
Printf.printf "my_str = %s\n" my_str;;

(* ä½¿ç”¨å•å¼•å·è¡¨ç¤ºå­—ç¬¦å­—é¢å€¼ã€‚ *)
let my_char = 'a' ;;
Printf.printf "my_char = %c\n" my_char;;

(* å•å¼•å·å’ŒåŒå¼•å·æ˜¯ä¸å¯äº’æ¢ *)
(* let bad_str = 'syntax error';; (* Error: Syntax error *) *)

(*
  è¿™ä¼šç»™ä½ ä¸€ä¸ªå•å­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ã€‚
*)
let single_cha_str = "a";;
Printf.printf "single_cha_str = %s\n" single_cha_str;;


(*
  åœ¨OCamlä¸­,å­—ç¬¦ä¸²å¯ä»¥ä½¿ç”¨"^"æ“ä½œç¬¦è¿›è¡Œè¿æ¥ã€‚
*)
let some_str = "hello" ^ " " ^ "world";;
Printf.printf "some_str = %s\n" some_str;;

(*
  å­—ç¬¦ä¸²ä¸æ˜¯å­—ç¬¦æ•°ç»„ã€‚
  ä½ ä¸èƒ½åœ¨è¡¨è¾¾å¼ä¸­æ··åˆä½¿ç”¨å­—ç¬¦å’Œå­—ç¬¦ä¸²ã€‚
  ä½ å¯ä»¥ä½¿ç”¨ "String.make 1 my_char" å°†å­—ç¬¦è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚
  åœ¨ä¸€äº›é¢å¤–çš„åº“ï¼ˆå¦‚ Core.Stdï¼‰ä¸­æœ‰æ›´æ–¹ä¾¿çš„å‡½æ•°ç”¨äºè¿™ä¸ªç›®çš„ï¼Œä½†è¿™äº›åº“å¯èƒ½é»˜è®¤æ²¡æœ‰å®‰è£…å’Œ/æˆ–åŠ è½½ã€‚
*)
let ocaml = (String.make 1 'O') ^ "Caml";;
Printf.printf "ocaml = %s\n" ocaml;;

(*
  è¿™æ˜¯ä¸€ä¸ªæ‰“å°å‡½æ•°
*)
Printf.printf "%d %s\n" 99 "bottles of beer";;

(* è¿˜æœ‰æœªæ ¼å¼åŒ–çš„è¯»å–å’Œå†™å…¥å‡½æ•°ã€‚ *)
print_string "Enter your name: ";;
(* print_endline "Hello world" ;; *)
let line = read_line ();;
Printf.printf "Hello, %s!\n" line;;

(*** ç”¨æˆ·å®šä¹‰çš„æ•°æ®ç±»å‹ ***)

(*
  ä½ å¯ä»¥ä½¿ç”¨ "type some_type =" ç»“æ„æ¥å®šä¹‰ç±»å‹ã€‚å°±åƒè¿™ä¸ªæ— ç”¨çš„ç±»å‹åˆ«åï¼š
*)
(* type my_int = int;; *)

(*
  æ›´æœ‰è¶£çš„ç±»å‹åŒ…æ‹¬æ‰€è°“çš„ç±»å‹æ„é€ å™¨ã€‚
  æ„é€ å™¨å¿…é¡»ä»¥å¤§å†™å­—æ¯å¼€å¤´ã€‚
*)
type ml = Ocaml | StandardML ;;
let ocaml_lang = Ocaml ;; (* lang : ml = Ocaml *)
let sml_lang = StandardML ;; (* lang : ml = StandardML *)

(* Use Match deal with ML type *)
let match_ml = function
  | Ocaml -&gt; Printf.printf "OCaml\n"
  | StandardML -&gt; Printf.printf "Standard ML\n";;

match_ml ocaml_lang;;
match_ml sml_lang;;

(*
  ä½ å¯ä»¥ä½¿ç”¨ "type some_type = | Constructor1 | Constructor2" æ¥å®šä¹‰ä¸€ä¸ªæšä¸¾ç±»å‹ã€‚
  æšä¸¾ç±»å‹çš„å€¼æ˜¯æœ‰é™çš„ï¼Œåªèƒ½æ˜¯å®šä¹‰çš„æ„é€ å™¨ä¹‹ä¸€ã€‚
*)

(* ç±»å‹æ„é€ å™¨ä¸éœ€è¦æ˜¯ç©ºçš„ã€‚ *)
type my_number = PlusInfinity | MinusInfinity | Real of float ;;

let match_my_number = function
  | PlusInfinity -&gt; Printf.printf "+âˆ\n"
  | MinusInfinity -&gt; Printf.printf "-âˆ\n"
  | Real x -&gt; Printf.printf "Real %f\n" x;;

let plus_inf = PlusInfinity ;; (* plus_inf : my_number = PlusInfinity *)
let minus_inf = MinusInfinity ;; (* minus_inf : my_number = MinusInfinity *)
let my_num = Real 3.14 ;; (* my_num : my_number = Real 3.14 *)

match_my_number my_num;;
match_my_number plus_inf;;
match_my_number minus_inf;;

(* å¯ä»¥ç”¨æ¥å®ç°å¤šæ€ç®—æœ¯ã€‚*)
type number = Int of int | Float of float ;;
let match_number = function
  | Int x -&gt; Printf.printf "Int %d\n" x
  | Float x -&gt; Printf.printf "Float %f\n" x;;

let add a b = match (a, b) with
  | (Int x, Int y) -&gt; Int (x + y)
  | (Float x, Float y) -&gt; Float (x +. y)
  | (Int x, Float y) -&gt; Float (float_of_int x +. y)
  | (Float x, Int y) -&gt; Float (x +. float_of_int y);;


let int1 = Int 2 ;;
let int2 = Int 2 ;;
let sum = add int1 int2 ;;
match_number sum;; (* Int 0 why is zero *)
let float1 = Float 2.0 ;;
let float2 = Float 2.0 ;;
let sum = add float1 float2 ;;
match_number sum;;

(*
  å¹³é¢ä¸Šçš„ç‚¹ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç±»å‹å—é™çš„å…ƒç»„
*)

type point2d = Point of float * float ;;
let my_point = Point (3.0, 4.0) ;;

(*
let get_x = function
  | Point (x, _) -&gt; x;;
let get_y = function
  | Point (_, y) -&gt; y;;
*)
let display_point = function
  | Point (x, y) -&gt; Printf.printf "(%f, %f)\n" x y;;

display_point my_point;;

(*
  ç±»å‹å¯ä»¥è¢«å‚æ•°åŒ–ï¼Œå°±åƒè¿™ä¸ª"ä»»æ„ç±»å‹çš„åˆ—è¡¨çš„åˆ—è¡¨"ç±»å‹ã€‚'a å¯ä»¥è¢«ä»»ä½•ç±»å‹æ›¿ä»£ã€‚
*)

type 'a list_of_lists = 'a list list ;;
(* type int_list_of_lists = int list list ;; *)

let my_list = [[1; 2]; [3; 4; 5]] ;;
let my_list2 = [[1; 2]; [3; 4; 5]; [6; 7; 8]] ;;

let count_elements (ll : 'a list_of_lists) : int =
  List.fold_left (fun acc l -&gt; acc + List.length l) 0 ll

let n_int = count_elements my_list ;;
Printf.printf "n_int = %d\n" n_int;;
let n_int2 = count_elements my_list2 ;;
Printf.printf "n_int2 = %d\n" n_int2;;

(*
  è¿™äº›ç‰¹æ€§å…è®¸åˆ›å»ºæœ‰ç”¨çš„å¯é€‰ç±»å‹
*)
type 'a option = None | Some of 'a ;;

let display_option = function
  | None -&gt; Printf.printf "None\n"
  | Some x -&gt; Printf.printf "Some %d\n" x;;

let x = Some 42 ;;
let y = None ;;

display_option x;;
display_option y;;

(*
  ç±»å‹ä¹Ÿå¯ä»¥æ˜¯é€’å½’çš„ã€‚å°±åƒè¿™ä¸ªç±»å‹ï¼Œå®ƒç±»ä¼¼äºå†…ç½®çš„æ•´æ•°åˆ—è¡¨ã€‚
*)
type my_int_list = EmptyList | IntList of int * my_int_list ;;
let my_int_list = IntList (1, IntList (2, IntList (3, EmptyList))) ;;

let rec display_int_list = function
  | EmptyList -&gt; Printf.printf "[]\n"
  | IntList (x, xs) -&gt; Printf.printf "%d :: " x; display_int_list xs;;

display_int_list my_int_list;;

(* Trees *)

(*
  äºŒå‰æ ‘æ˜¯ä¸€ä¸ªé€’å½’çš„æ•°æ®ç»“æ„ï¼Œå®ƒå¯ä»¥ç”¨ä¸€ä¸ªèŠ‚ç‚¹å’Œä¸¤ä¸ªå­æ ‘æ¥å®šä¹‰ã€‚
  ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥æ˜¯ä¸€ä¸ªå¶å­ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚
*)

type 'a tree = Leaf | Node of 'a tree * 'a * 'a tree ;;
let my_tree = Node (Node (Leaf, 2,  Leaf), 1 , Node (Leaf, 3, Leaf)) ;;

let rec display_tree = function
  | Leaf -&gt; Printf.printf ""
  | Node (left, x, right) -&gt;
    Printf.printf "%d " x;
    display_tree left;
    display_tree right;;

display_tree my_tree;;

print_endline "";;

(*
  Records
*)

(* ä¸€ä¸ªå…·æœ‰å‘½åå­—æ®µçš„å€¼çš„é›†åˆ *)

(*
type animal =
  {
    name : string;
    age : int;
    species : string;
  };; (* type animal = { name : string; age : int; species : string } *)

let my_pet = {name = "Bobby"; age = 3; species = "Dog"} ;;

let display_animal a =
  Printf.printf "Name: %s\n" a.name;
  Printf.printf "Age: %d\n" a.age;
  Printf.printf "Species: %s\n" a.species;;

display_animal my_pet;;

*)

(*** Pattern matching ***)

(*
æ¨¡å¼åŒ¹é…åœ¨æŸç§ç¨‹åº¦ä¸Šç±»ä¼¼äºå‘½ä»¤å¼è¯­è¨€ä¸­çš„switchè¯­å¥ï¼Œä½†æä¾›äº†æ›´å¼ºå¤§çš„è¡¨è¾¾èƒ½åŠ›ã€‚

å°½ç®¡çœ‹èµ·æ¥å¯èƒ½å¾ˆå¤æ‚ï¼Œä½†å®ƒå®é™…ä¸Šå½’ç»“ä¸ºå°†å‚æ•°ä¸ç²¾ç¡®å€¼ã€è°“è¯æˆ–ç±»å‹æ„é€ å™¨è¿›è¡ŒåŒ¹é…ã€‚
ç±»å‹ç³»ç»Ÿæ˜¯ä½¿å®ƒå¦‚æ­¤å¼ºå¤§çš„åŸå› ã€‚
*)

(* Matching exact values.  *)

let is_zero x = match x with
  | 0 -&gt; true
  | _ -&gt; false;; (* _ æ˜¯é€šé…ç¬¦ *)

Printf.printf "is_zero 0 = %b\n" (is_zero 0);;

(*
  æˆ–è€…ï¼Œä½ å¯ä»¥ä½¿ç”¨ "function" å…³é”®å­—ã€‚
  function å…³é”®å­—æ˜¯OCamlä¸­ç”¨äºåˆ›å»ºåŒ¿åå‡½æ•°å¹¶ç«‹å³è¿›è¡Œæ¨¡å¼åŒ¹é…çš„ç®€ä¾¿æ–¹æ³•ã€‚å®ƒç­‰ä»·äºä½¿ç”¨ match ... with ç»“æ„ï¼Œä½†è¯­æ³•æ›´åŠ ç®€æ´ã€‚
*)

let is_zero = function
  | 0 -&gt; true
  | _ -&gt; false;;

Printf.printf "is_zero 0 = %b\n" (is_zero 0);;

(* åŒ¹é…è°“è¯ï¼Œä¹Ÿç§°ä¸º"å¸¦å®ˆå«çš„æ¨¡å¼åŒ¹é…"ã€‚ *)



let abs x =
  match x with
    | x when x &lt; 0 -&gt; -x
    | x -&gt; x
;;

let result = abs (-3);;
Printf.printf "abs (-3) = %d\n" result;;

(* åŒ¹é…ç±»å‹æ„é€ å™¨ *)

type animal = Dog of string | Cat of string ;;

let say x =
  match x with
  | Dog x -&gt; x ^ " says Woof!"
  | Cat x -&gt; x ^ " say meow"
;;

let dog = say (Dog "Bobby");;
Printf.printf "%s\n" dog;;
let cat = say (Cat "mow");;
Printf.printf "%s\n" cat;;

(* ç„¶è€Œï¼Œæ¨¡å¼åŒ¹é…å¿…é¡»æ˜¯ç©·å°½çš„ *)
type color = Red | Green | Blue ;;
let what_color = function
  | Red -&gt; "Red"
  | Green -&gt; "Green"
  | Blue -&gt; "Blue"
;;

let color_red = what_color Red;;
let color_green = what_color Green;;
let color_blue = what_color Blue;;
Printf.printf "color = %s\n" color_red;;
Printf.printf "color = %s\n" color_green;;
Printf.printf "color = %s\n" color_blue;;

(*
let what_color x =
   match x with
   | Red -&gt; "color is red"
   | Blue -&gt; "color is blue"
   (* Won't compile! You have to add a _ case or a Green case
      to ensure all possibilities are accounted for *)
;;
*)

(*
  å¦å¤–ï¼Œmatchè¯­å¥æŒ‰é¡ºåºæ£€æŸ¥æ¯ä¸ªæƒ…å†µã€‚
  æ‰€ä»¥ï¼Œå¦‚æœä¸€ä¸ª _ æƒ…å†µå‡ºç°åœ¨æœ€å‰é¢ï¼Œåé¢çš„æ‰€æœ‰æƒ…å†µéƒ½å°†æ— æ³•è¢«åŒ¹é…åˆ°ï¼
*)

(*
  å¦‚æœæ²¡æœ‰ç©·å°½æ¨¡å¼åŒ¹é…ï¼ŒOCamlä¼šå‘å‡ºè­¦å‘Šã€‚
  ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ "_" é€šé…ç¬¦æ¥åŒ¹é…æ‰€æœ‰å…¶ä»–æƒ…å†µã€‚
*)

(* ä½¿ç”¨æ¨¡å¼åŒ¹é…éå†æ•°æ®ç»“æ„ *)

(*
  é€’å½’ç±»å‹å¯ä»¥é€šè¿‡æ¨¡å¼åŒ¹é…è½»æ¾éå†ã€‚
  è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•éå†å†…ç½®åˆ—è¡¨ç±»å‹çš„æ•°æ®ç»“æ„ã€‚
  å°½ç®¡å†…ç½®çš„consè¿ç®—ç¬¦ï¼ˆ"::"ï¼‰çœ‹èµ·æ¥åƒä¸€ä¸ªä¸­ç¼€è¿ç®—ç¬¦ï¼Œ
  ä½†å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªç±»å‹æ„é€ å™¨ï¼Œå¯ä»¥åƒå…¶ä»–æ„é€ å™¨ä¸€æ ·è¿›è¡ŒåŒ¹é…ã€‚
*)

(*
let rec sum_list l =
    match l with
    | [] -&gt; 0
    | head :: tail -&gt; head + (sum_list tail)
;;
*)
let rec sum_list = function
  | [] -&gt; 0
  | x :: xs -&gt; x + sum_list xs;;

let sum = sum_list [1; 2; 3; 4; 5];;
Printf.printf "sum = %d\n" sum;;

(*
  å†…ç½®çš„consè¯­æ³•ç¨å¾®æ¨¡ç³Šäº†ç»“æ„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†åˆ›å»ºè‡ªå·±çš„åˆ—è¡¨æ¥è¿›è¡Œæ¼”ç¤ºã€‚
*)
type int_list = Nil | Cons of int * int_list ;;
let my_int_list = Cons (1, Cons (2, Cons (3, Cons (4, Nil)))) ;;

let rec sum_int_list = function
  | Nil -&gt; 0
  | Cons (x, xs) -&gt; x + sum_int_list xs;;
let sum = sum_int_list my_int_list;;
Printf.printf "sum = %d\n" sum;;

(*
  å®ç°ä¸€ä¸ªæ£€æŸ¥åˆ—è¡¨æ˜¯å¦å·²æ’åºçš„å‡½æ•°
*)
let rec is_sorted l = match l with
  | x :: y :: tail -&gt; x &lt;= y &amp;&amp; is_sorted (y :: tail)
  | _ -&gt; true;;

let sorted = is_sorted [1; 2; 3; 4; 5];;
Printf.printf "sorted = %b\n" sorted;;

(*
  OCamlå¼ºå¤§çš„ç±»å‹æ¨æ–­çŒœæµ‹ l çš„ç±»å‹æ˜¯ int listï¼Œ
  å› ä¸º &lt;= è¿ç®—ç¬¦è¢«ç”¨äº l çš„å…ƒç´ ä¸Š
*)

(* åè½¬list *)
let rec rev (l: 'a list): 'a list =
  match l with
  | [] -&gt; []
  | x :: xs -&gt; rev xs @ [x];; (* @ æ˜¯è¿æ¥æ“ä½œç¬¦ *)

let reversed = rev [1; 2; 3; 4; 5];;
Printf.printf "reversed = %s\n" (String.concat " " (List.map string_of_int reversed));;
(* è¿™ä¸ªå‡½æ•°å¯ä»¥é€‚ç”¨äºä»»ä½•å…ƒç´ ç±»å‹çš„åˆ—è¡¨ *)

(*** é«˜é˜¶å‡½æ•° ***)

(** å‡½æ•°åœ¨OCamlä¸­æ˜¯ä¸€ç­‰å…¬æ°‘ **)

let rec transform (f: 'a -&gt; 'b) (l: 'a list): 'b list =
  match l with
  | [] -&gt; []
  | x :: xs -&gt; f x :: transform f xs ;;

let double = transform (fun x -&gt; x * 2) [1; 2; 3; 4; 5];;
Printf.printf "double = %s\n" (String.concat " " (List.map string_of_int double));;

(*
  è®©æˆ‘ä»¬æ¥ç»¼åˆè¿ç”¨æˆ‘ä»¬å­¦åˆ°çš„æ‰€æœ‰æ¦‚å¿µ
*)
let rec filter (pred: 'a -&gt; bool) (l: 'a list): 'a list =
  begin match l with
  | [] -&gt; []
  | x :: xs -&gt;
    let rest = filter pred xs in
    if pred x then x :: rest else rest
  end
;;

(*
  åœ¨è¿™é‡Œï¼Œin åé¢ä½¿ç”¨çš„ rest å°±æ˜¯åœ¨ let ç»‘å®šä¸­å®šä¹‰çš„ restã€‚è®©æˆ‘è¯¦ç»†è§£é‡Šï¼š

  ä½œç”¨åŸŸï¼š
    let ç»‘å®šåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸã€‚
    in å…³é”®å­—åé¢çš„è¡¨è¾¾å¼æ˜¯è¿™ä¸ªæ–°ä½œç”¨åŸŸçš„ä¸»ä½“ã€‚
  ç»‘å®šé¡ºåºï¼š
    é¦–å…ˆï¼Œfilter pred xs è¢«æ±‚å€¼ï¼Œå…¶ç»“æœè¢«ç»‘å®šåˆ° restã€‚
    ç„¶åï¼Œin åé¢çš„è¡¨è¾¾å¼åœ¨çŸ¥é“ rest çš„å€¼çš„æƒ…å†µä¸‹è¢«æ±‚å€¼ã€‚
  rest çš„ä½¿ç”¨ï¼š
    åœ¨æ¡ä»¶è¯­å¥ if pred x then x :: rest else rest ä¸­ï¼Œä¸¤æ¬¡ä½¿ç”¨çš„ rest éƒ½æ˜¯æŒ‡å‘åˆšåˆšé€šè¿‡ let ç»‘å®šåˆ›å»ºçš„ restã€‚
  é—­åŒ…æ•ˆæœï¼š
    è¿™ç§ç»“æ„åˆ›å»ºäº†ä¸€ä¸ªå°çš„é—­åŒ…ï¼Œå…¶ä¸­ rest åœ¨ if è¯­å¥ä¸­å¯ç”¨
*)

let result = filter (fun x -&gt; x mod 2 = 0) [1; 2; 3; 4; 5];;
Printf.printf "result = %s\n" (String.concat " " (List.map string_of_int result));;

(*
  ä½ å¯ä»¥ä½¿ç”¨é«˜é˜¶å‡½æ•°æ¥åˆ›å»ºæ›´é«˜é˜¶çš„å‡½æ•°ã€‚
  ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ filter å‡½æ•°æ¥å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—ä¸€ä¸ªè°“è¯å‡½æ•°å’Œä¸€ä¸ªåˆ—è¡¨ï¼Œ
  å¹¶è¿”å›ä¸€ä¸ªæ–°åˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰æ»¡è¶³è°“è¯çš„å…ƒç´ ã€‚
*)

(*** Mutability ***)

(* è®°å½•å’Œå˜é‡æ˜¯ä¸å¯å˜çš„ï¼šä½ ä¸èƒ½æ”¹å˜å˜é‡æŒ‡å‘çš„å¯¹è±¡ *)

(** å°½ç®¡ OCaml ä¸»è¦å¼ºè°ƒä¸å¯å˜æ€§ï¼Œä½†å®ƒä¹Ÿæä¾›äº†åˆ›å»ºå¯å˜å­—æ®µçš„èƒ½åŠ›ï¼ŒåŒ…æ‹¬å¤šæ€å¯å˜å­—æ®µ **)

type counter = { mutable count: int };;
let c = { count = 0 };; (* åˆ›å»ºè®°å½• *)
Printf.printf "c.count = %d\n" c.count;;
c.count &lt;- 1;; (* ä¿®æ”¹å¯å˜å­—æ®µ *)
Printf.printf "c.count = %d\n" c.count;;

(*
  è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨ &lt;- è¿ç®—ç¬¦æ¥ä¿®æ”¹å¯å˜å­—æ®µã€‚
  è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨ { count = 0 } æ¥åˆ›å»ºè®°å½•ã€‚
  è¿™æ˜¯ä¸€ç§ç®€å†™ï¼Œå®ƒç­‰åŒäº { count = 0; }ã€‚
*)

(* OCaml çš„æ ‡å‡†åº“ç¡®å®æä¾›äº† ref ç±»å‹ï¼Œè¿™æ˜¯ä¸€ç§æ›´ç®€å•ã€æ›´å¸¸ç”¨çš„æ–¹å¼æ¥å®ç°å•å­—æ®µçš„å¯å˜æ€§ã€‚ *)

(* type 'a ref = { mutable contents: 'a };;*)
(*
  davirian@daviriandeMBP learn_x % dune exec learn_x
  File "bin/main.ml", line 843, characters 0-38:
  843 | type 'a ref = { mutable contents: 'a };;
  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  Error (warning 34 [unused-type-declaration]): unused type ref.

  File "bin/main.ml", line 843, characters 16-36:
  843 | type 'a ref = { mutable contents: 'a };;
  ^^^^^^^^^^^^^^^^^^^^
  Error (warning 69 [unused-field]): unused record field contents.

  è¿™äº›è­¦å‘Šå‡ºç°çš„åŸå› æ˜¯ï¼š

  OCaml æ ‡å‡†åº“å·²ç»å®šä¹‰äº† ref ç±»å‹ï¼Œæ‚¨ä¸éœ€è¦å†æ¬¡å®šä¹‰å®ƒã€‚
  æ‚¨çš„ä»£ç ä¸­ä½¿ç”¨çš„ refã€! å’Œ := å®é™…ä¸Šæ˜¯ä½¿ç”¨çš„æ ‡å‡†åº“ä¸­çš„å®šä¹‰ï¼Œè€Œä¸æ˜¯æ‚¨è‡ªå·±å®šä¹‰çš„ç±»å‹ã€‚
*)
let counter = ref 0;; (* åˆ›å»ºä¸€ä¸ªå¼•ç”¨ *)
Printf.printf "counter.contents = %d\n" counter.contents;;
Printf.printf "counter.contents = %d\n" !counter;; (* è¯»å–å¼•ç”¨çš„å†…å®¹ *)
counter := !counter + 1;; (* ä¿®æ”¹å¼•ç”¨çš„å†…å®¹ *)
Printf.printf "counter.contents = %d\n" !counter;;

(*
  è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨ := è¿ç®—ç¬¦æ¥ä¿®æ”¹å¼•ç”¨çš„å†…å®¹ã€‚
  è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨ !counter æ¥è¯»å–å¼•ç”¨çš„å†…å®¹ã€‚
  è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨ ref 0 æ¥åˆ›å»ºå¼•ç”¨ã€‚
  è¿™æ˜¯ä¸€ç§ç®€å†™ï¼Œå®ƒç­‰åŒäº { contents = 0; }ã€‚
*)
</code></pre>
            </div>
<h2 id="è¿›ä¸€æ­¥é˜…è¯»">è¿›ä¸€æ­¥é˜…è¯»</h2>
<ul>
<li>è®¿é—®å®˜æ–¹ç½‘ç«™è·å–ç¼–è¯‘å™¨å¹¶é˜…è¯»æ–‡æ¡£ï¼š<a href="http://ocaml.org/">http://ocaml.org/</a></li>
<li>OCaml å¿«é€Ÿæ•™ç¨‹ï¼š<a href="https://ocaml.org/docs/up-and-running">https://ocaml.org/docs/up-and-running</a></li>
<li>å®Œæ•´çš„åœ¨çº¿ OCaml v5 æ¸¸ä¹åœºï¼š<a href="https://ocaml.org/play">https://ocaml.org/play</a></li>
<li>æœ€æ–°ï¼ˆ2022 å¹´ï¼‰ä¹¦ç±ï¼ˆå…è´¹åœ¨çº¿ç‰ˆæœ¬ï¼‰â€œReal World OCamlâ€:<a href="https://www.cambridge.org/core/books/real-world-ocaml-functional-programming-for-the-masses/052E4BCCB09D56A0FE875DD81B1ED571"> https://www.cambridge.org/core/books/real-world-ocaml-functional-programming-for-the-masses/052E4BCCB09D56A0FE875DD81B1ED571</a></li>
<li>åº·å¥ˆå°”å¤§å­¦åœ¨çº¿äº’åŠ¨æ•™æã€ŠOCaml ç¼–ç¨‹ï¼šæ­£ç¡®+é«˜æ•ˆ+ç¾ä¸½ã€‹ï¼š<a href="https://cs3110.github.io/textbook/cover.html">https://cs3110.github.io/textbook/cover.html</a></li>
<li>å°è¯• OCaml Pro çš„äº¤äº’å¼æ•™ç¨‹å’ŒåŸºäº Web çš„è§£é‡Šå™¨ï¼š<a href="http://try.ocamlpro.com/">http://try.ocamlpro.com/</a></li>
</ul>

        </div>
    </div>
    

    <footer class="post-footer">
        <div class="post-info">
            <p><strong>Storage ID:</strong> <code>QmehMPqbtR2iUdrLNiNdJjqQCYa59vXFnK5SQq6GtZPB6R</code></p>
            
            <p><strong>IPFS Link:</strong> <a href="https:&#x2F;&#x2F;ipfs.io&#x2F;ipfs&#x2F;QmehMPqbtR2iUdrLNiNdJjqQCYa59vXFnK5SQq6GtZPB6R" target="_blank">View on IPFS</a></p>
            
            <p><strong>Content Hash:</strong> <code>743c937a44143ebe420f38905e2906e4d85987183b7cd5b685501f9d118960fa</code></p>
        </div>
        <nav class="post-nav">
            <a href="/archive.html">â† Back to Archive</a>
        </nav>
    </footer>

    
    
    <section class="related-posts">
        <h2>Related Posts</h2>
        <div class="related-posts-grid">
            
            <article class="related-post-card">
                <h3><a href="&#x2F;kpgb&#x2F;posts&#x2F;chanzhe.html">ç¦…è€…çš„åˆå¿ƒğŸ“’</a></h3>
                <div class="post-meta">
                    <span class="date">2025-07-23</span>
                    
                    <span class="reading-time">1 min read</span>
                    
                </div>
                
                    <p class="excerpt">æ˜¯æ™ºæ…§åœ¨è¿½å¯»æ™ºæ…§ã€‚ åˆå­¦è€…çš„å¿ƒæ˜¯å¼€æ”¾çš„ï¼Œè€Œè¡Œå®¶çš„å¿ƒæ˜¯æ”¶ç´§çš„ã€‚ æˆ‘ä»¬çš„æœ¬å¿ƒå†…å«ä¸‡ç‰©ï¼Œå®ƒæœ¬è‡ªå…·è¶³ã€‚ å¦‚æœä½ çš„å¿ƒæ˜¯ç©ºçš„ï¼Œå®ƒå¯ä»¥éšæ—¶æ¥å—ä»»ä½•äº‹ç‰©ï¼›å®ƒå‘æ‰€æœ‰çš„äº‹ç‰©å¼€æ”¾ã€‚åˆå­¦è€…çš„å¿ƒæ˜¯å¼€æ”¾çš„ï¼Œè€Œè¡Œå®¶çš„å¿ƒæ˜¯æ”¶ç´§çš„ã€‚ åˆ†åˆ«å¿ƒå¤ªé‡ï¼Œæ˜¯è‡ªæˆ‘æŸç¼šã€‚å¤ªè¿‡è‹›åˆ»å’Œè´ªå©ªï¼Œä½ çš„å¿ƒä¾¿ä¸ä¼šä¸°é¥¶å¯Œè¶³ã€‚è€Œå¤±å»äº†æœ¬è‡ªå…·è¶³çš„å¿ƒï¼Œæˆ‘ä»¬ä¼šå¤±å®ˆæ‰€æœ‰çš„â€¦</p>
                
                
            </article>
            
            <article class="related-post-card">
                <h3><a href="&#x2F;kpgb&#x2F;posts&#x2F;T.html">TingHuè¯­å½•ğŸ“’</a></h3>
                <div class="post-meta">
                    <span class="date">2025-07-23</span>
                    
                    <span class="reading-time">4 min read</span>
                    
                </div>
                
                    <p class="excerpt">å¤§å¤šæ•°äººæœ€åè·‘ä¸èµ¢æ¯”ç‰¹å¸è¿™å¥è¯æˆ‘éƒ½ä¸çŸ¥é“è®²äº†å¤šå°‘æ¬¡äº†(å®é™…ä¸Šæœ€åå¾ˆå¤šäººè¿˜äºé’±)ã€‚ å¦‚æœä½ æŒ‡æœ›æˆ‘é€šè¿‡æ¨èä½ ä¹°å°å±±å¯¨è·‘èµ¢æ¯”ç‰¹å¸ï¼Œé‚£è¿˜æ˜¯åˆ«å…³æ³¨æˆ‘äº†ï¼Œæˆ‘æ²¡æœ‰åŠæ³•ç»™å‡ºæˆ‘è®¤ä¸ºåˆç†çš„å»ºè®®ã€‚ ç°åœ¨è¯´ä¹Ÿè®¸è¿˜æ—©ï¼Œä½†æ˜¯å¤§å®¶å¯ä»¥è®°ä½è¿™ä¸€æ¡ï¼Œå¹´åº•ç­›é€‰æŠ•èµ„æ ‡çš„çš„æ—¶å€™ï¼Œ 2019-2021è¿™è½®ç‰›å¸‚è¡¨ç°ä¸€èˆ¬çš„è€å¸ï¼Œå…¨éƒ¨ä¸ä½œä¸ºç›®æ ‡ï¼Œâ€¦</p>
                
                
            </article>
            
            <article class="related-post-card">
                <h3><a href="&#x2F;kpgb&#x2F;posts&#x2F;rust-raw-pointer.html">About Rust Raw Pointer</a></h3>
                <div class="post-meta">
                    <span class="date">2025-07-23</span>
                    
                    <span class="reading-time">2 min read</span>
                    
                </div>
                
                    <p class="excerpt">åœ¨Rustä¸­å¯ä»¥ä½¿ç”¨åŸç”ŸæŒ‡é’ˆï¼ŒåŸç”ŸæŒ‡é’ˆæ˜¯ä¸€ç§è£¸æŒ‡é’ˆï¼Œä¸å—Rustçš„å®‰å…¨æ€§æ£€æŸ¥é™åˆ¶ã€‚ åŸç”ŸæŒ‡é’ˆæœ‰ä¸¤ç§ç±»å‹ï¼š å’Œ ï¼Œåˆ†åˆ«æ˜¯ä¸å¯å˜å’Œå¯å˜çš„åŸç”ŸæŒ‡é’ˆã€‚ Rustæä¾›äº†ä¸€ä¸ªå‡½æ•°å¯ä»¥è·å–ç±»å‹çš„å¤§å°ï¼š ã€‚ è¿™é‡Œæä¾›äº†ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨åŸç”ŸæŒ‡é’ˆã€‚ åŸç”ŸæŒ‡é’ˆæ˜¯ä¸€ç§è£¸æŒ‡é’ˆï¼Œä¸å—Rustçš„å®‰å…¨æ€§æ£€æŸ¥é™åˆ¶ï¼Œå¯ä»¥â€¦</p>
                
                
            </article>
            
            <article class="related-post-card">
                <h3><a href="&#x2F;kpgb&#x2F;posts&#x2F;learn-ocaml-sources.html">å­¦ä¹ Ocamlçš„èµ„æº</a></h3>
                <div class="post-meta">
                    <span class="date">2025-07-23</span>
                    
                    <span class="reading-time">1 min read</span>
                    
                </div>
                
                    <p class="excerpt">Introduction to Objective Ocaml Objective Caml ç®€ä»‹ã€‚ OCaml from the Very Beginning ä¸€æœ¬éå¸¸æ¸©å’Œçš„æ•™ç§‘ä¹¦ï¼Œæ¨èç”¨äºæœ¬è¯¾ç¨‹ã€‚æœ¬ä¹¦çš„ PDF å’Œ HTML æ ¼å¼éƒ½æ˜¯å…è´¹çš„ã€‚ A guided tour [ of OCaml ]â€¦</p>
                
                
            </article>
            
            <article class="related-post-card">
                <h3><a href="&#x2F;kpgb&#x2F;posts&#x2F;rust-tips.html">About Rust tips</a></h3>
                <div class="post-meta">
                    <span class="date">2025-07-23</span>
                    
                    <span class="reading-time">7 min read</span>
                    
                </div>
                
                    <p class="excerpt">åœ¨ Rust ä¸­ï¼Œå¦‚æœä½ æƒ³ä¸ºä½ çš„ ä¸­çš„ç±»å‹ç¼–å†™å¸¦æœ‰å¯é€‰çš„ çš„æµ‹è¯•ï¼Œä½ å¯ä»¥ä½¿ç”¨ å±æ€§å’Œ å±æ€§æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ åªæœ‰åœ¨ è¢«å¯ç”¨æ—¶æ‰ä¼šè¢«å®šä¹‰ï¼ŒåŒæ ·ï¼Œ æµ‹è¯•ä¹Ÿåªæœ‰åœ¨ è¢«å¯ç”¨æ—¶æ‰ä¼šè¢«è¿è¡Œã€‚ è¦è¿è¡Œè¿™ä¸ªæµ‹è¯•ï¼Œä½ éœ€è¦ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼Œå…¶ä¸­ æ˜¯ä½ çš„ çš„åå­—ï¼š è¿™ä¸ªå‘½ä»¤ä¼šå¯ç”¨ ç‰¹æ€§å¹¶è¿è¡Œæ‰€â€¦</p>
                
                
            </article>
            
        </div>
    </section>
    

    
    
    <div class="comments">
        <h2>Comments</h2>
        <script src="https://giscus.app/client.js"
                data-repo="davirain-su&#x2F;kpgb"
                data-repo-id="R_kgDOPP4-yg"
                data-category="General"
                data-category-id="DIC_kwDOPP4-ys4CtTKw"
                data-mapping="pathname"
                data-strict="0"
                data-reactions-enabled="1"
                data-emit-metadata="0"
                data-input-position="bottom"
                data-theme="preferred_color_scheme"
                data-lang="zh-CN"
                data-loading="lazy"
                crossorigin="anonymous"
                async>
        </script>
    </div>
    
</article>


<script>
// TOC active section highlighting
(function() {
    const tocLinks = document.querySelectorAll('.toc-link');
    const headings = document.querySelectorAll('.post-content h1[id], .post-content h2[id], .post-content h3[id], .post-content h4[id], .post-content h5[id], .post-content h6[id]');
    
    if (tocLinks.length === 0 || headings.length === 0) return;
    
    function updateActiveSection() {
        const scrollPosition = window.scrollY + 100; // Offset for better UX
        
        let activeHeading = null;
        for (const heading of headings) {
            if (heading.offsetTop <= scrollPosition) {
                activeHeading = heading;
            } else {
                break;
            }
        }
        
        if (activeHeading) {
            tocLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + activeHeading.id) {
                    link.classList.add('active');
                }
            });
        }
    }
    
    // Update on scroll
    let scrollTimer;
    window.addEventListener('scroll', () => {
        clearTimeout(scrollTimer);
        scrollTimer = setTimeout(updateActiveSection, 50);
    });
    
    // Initial update
    updateActiveSection();
})();
</script>


<script>
// Reading Progress Bar
(function() {
    const progressBar = document.getElementById('progress-bar');
    const article = document.querySelector('.post');
    
    if (!progressBar || !article) return;
    
    function updateProgressBar() {
        const articleTop = article.offsetTop;
        const articleHeight = article.offsetHeight;
        const windowHeight = window.innerHeight;
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        
        // Add/remove scrolled class
        if (scrollTop > 50) {
            document.body.classList.add('scrolled');
        } else {
            document.body.classList.remove('scrolled');
        }
        
        // Calculate the scrollable area (article height minus viewport height)
        const scrollableArea = articleHeight + articleTop - windowHeight;
        
        // Calculate current scroll position relative to the article
        const currentPosition = scrollTop - articleTop + windowHeight;
        
        // Calculate progress percentage
        let progress = (currentPosition / scrollableArea) * 100;
        
        // Clamp progress between 0 and 100
        progress = Math.max(0, Math.min(100, progress));
        
        // Update progress bar width
        progressBar.style.width = progress + '%';
    }
    
    // Update on scroll
    let scrollTimer;
    window.addEventListener('scroll', () => {
        clearTimeout(scrollTimer);
        scrollTimer = setTimeout(updateProgressBar, 10);
    });
    
    // Update on resize
    window.addEventListener('resize', updateProgressBar);
    
    // Initial update
    updateProgressBar();
})();

// Font Size Adjuster
(function() {
    const MIN_SIZE = 80;
    const MAX_SIZE = 150;
    const STEP = 10;
    const DEFAULT_SIZE = 100;
    
    // Get saved font size from localStorage
    let currentSize = parseInt(localStorage.getItem('postFontSize')) || DEFAULT_SIZE;
    
    // Apply saved font size on load
    applyFontSize(currentSize);
    
    window.changeFontSize = function(action) {
        switch(action) {
            case 'increase':
                currentSize = Math.min(currentSize + STEP, MAX_SIZE);
                break;
            case 'decrease':
                currentSize = Math.max(currentSize - STEP, MIN_SIZE);
                break;
            case 'reset':
                currentSize = DEFAULT_SIZE;
                break;
        }
        
        applyFontSize(currentSize);
        localStorage.setItem('postFontSize', currentSize);
    };
    
    function applyFontSize(size) {
        const postContent = document.querySelector('.post-content');
        const sizeValue = document.getElementById('font-size-value');
        
        if (postContent) {
            postContent.style.fontSize = size + '%';
        }
        
        if (sizeValue) {
            sizeValue.textContent = size + '%';
        }
        
        // Update button states
        document.querySelectorAll('.font-size-btn').forEach(btn => {
            btn.disabled = false;
        });
        
        if (size <= MIN_SIZE) {
            document.querySelector('.font-size-btn[onclick*="decrease"]').disabled = true;
        }
        if (size >= MAX_SIZE) {
            document.querySelector('.font-size-btn[onclick*="increase"]').disabled = true;
        }
    }
})();

// Zen Mode
(function() {
    let isZenMode = false;
    
    window.toggleZenMode = function() {
        isZenMode = !isZenMode;
        const body = document.body;
        const zenBtn = document.querySelector('.zen-mode-btn');
        const zenText = document.querySelector('.zen-mode-text');
        
        if (isZenMode) {
            body.classList.add('zen-mode');
            zenText.textContent = 'Exit Zen';
            zenBtn.setAttribute('title', 'Exit Zen Mode');
            
            // Hide elements for zen mode
            document.querySelector('header')?.classList.add('zen-hidden');
            document.querySelector('footer')?.classList.add('zen-hidden');
            document.querySelector('.post-footer')?.classList.add('zen-hidden');
            document.querySelector('.related-posts')?.classList.add('zen-hidden');
            document.querySelector('.comments')?.classList.add('zen-hidden');
            document.querySelector('.toc-container')?.classList.add('zen-hidden');
            document.querySelector('.font-size-adjuster')?.classList.add('zen-fade');
            
            // Adjust reading progress bar
            document.querySelector('.reading-progress')?.classList.add('zen-minimal');
            
            // Focus on content
            document.querySelector('.post')?.classList.add('zen-focused');
            
            // Add ESC key listener
            document.addEventListener('keydown', handleZenEscape);
        } else {
            exitZenMode();
        }
    };
    
    function exitZenMode() {
        isZenMode = false;
        const body = document.body;
        const zenBtn = document.querySelector('.zen-mode-btn');
        const zenText = document.querySelector('.zen-mode-text');
        
        body.classList.remove('zen-mode');
        zenText.textContent = 'Zen Mode';
        zenBtn.setAttribute('title', 'Enter Zen Mode');
        
        // Show elements
        document.querySelector('header')?.classList.remove('zen-hidden');
        document.querySelector('footer')?.classList.remove('zen-hidden');
        document.querySelector('.post-footer')?.classList.remove('zen-hidden');
        document.querySelector('.related-posts')?.classList.remove('zen-hidden');
        document.querySelector('.comments')?.classList.remove('zen-hidden');
        document.querySelector('.toc-container')?.classList.remove('zen-hidden');
        document.querySelector('.font-size-adjuster')?.classList.remove('zen-fade');
        document.querySelector('.reading-progress')?.classList.remove('zen-minimal');
        document.querySelector('.post')?.classList.remove('zen-focused');
        
        // Remove ESC key listener
        document.removeEventListener('keydown', handleZenEscape);
    }
    
    function handleZenEscape(e) {
        if (e.key === 'Escape' && isZenMode) {
            exitZenMode();
        }
    }
})();
</script>

        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 Anonymous. Powered by IPFS & KPGB.</p>
            <p>A decentralized blog powered by IPFS</p>
        </div>
    </footer>
    
    <script>
    // Copy code function
    function copyCode(codeId) {
        const codeElement = document.getElementById(codeId);
        if (!codeElement) return;
        
        const textToCopy = codeElement.textContent;
        
        // Use modern clipboard API if available
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(textToCopy).then(() => {
                showCopySuccess(codeId);
            }).catch(err => {
                fallbackCopy(textToCopy, codeId);
            });
        } else {
            fallbackCopy(textToCopy, codeId);
        }
    }
    
    function fallbackCopy(text, codeId) {
        const textArea = document.createElement("textarea");
        textArea.value = text;
        textArea.style.position = "fixed";
        textArea.style.left = "-999999px";
        document.body.appendChild(textArea);
        textArea.select();
        
        try {
            document.execCommand('copy');
            showCopySuccess(codeId);
        } catch (err) {
            console.error('Failed to copy:', err);
        } finally {
            document.body.removeChild(textArea);
        }
    }
    
    function showCopySuccess(codeId) {
        const button = document.querySelector(`button[data-code-id="${codeId}"]`);
        if (!button) return;
        
        const copyText = button.querySelector('.copy-text');
        const originalText = copyText.textContent;
        
        copyText.textContent = 'Copied!';
        button.classList.add('copy-success');
        
        setTimeout(() => {
            copyText.textContent = originalText;
            button.classList.remove('copy-success');
        }, 2000);
    }
    </script>
</body>
</html>